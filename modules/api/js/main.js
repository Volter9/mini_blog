!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e()
else if("function"==typeof define&&define.amd)define([],e)
else{var t
t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.mini_blog=e()}}(function(){return function e(t,n,i){function o(r,a){if(!n[r]){if(!t[r]){var c="function"==typeof require&&require
if(!a&&c)return c(r,!0)
if(s)return s(r,!0)
var d=new Error("Cannot find module '"+r+"'")
throw d.code="MODULE_NOT_FOUND",d}var u=n[r]={exports:{}}
t[r][0].call(u.exports,function(e){var n=t[r][1][e]
return o(n?n:e)},u,u.exports,e,t,n,i)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r])
return o}({1:[function(e,t,n){var i=e("../editor"),o=(e("../../helpers/dom"),{components:{}})
o.register=function(e,t){this.components[e]={constructor:t}},o.create=function(e,t){return this.components[e]?new this.components[e].constructor(t):!1},o.createComponent=function(e){if(!e.component&&!e.dataset.ignore){var t=e.dataset.component,n=o.create(t,e)
if(!n)return console.warn('Component "'+t+'" does not exists!')
var s=new i(null,{node:e,component:n})
n.insertEditor(s),e.component=n,e.editor=s}},t.exports=o},{"../../helpers/dom":17,"../editor":4}],2:[function(e,t,n){function i(e){this.node=e,this.initialize()}var o=(e("../../helpers/utils"),e("../overlay"))
i.prototype.initialize=function(){},i.prototype.enable=function(){this.node.style.position="relative",this.node.style.zIndex=9e3,o.show(),this.view.activate()},i.prototype.disable=function(){this.node.style.position="",this.node.style.zIndex="",o.hide(),this.view.deactivate()},i.prototype.insertEditor=function(e){this.editor=e,this.node.appendChild(e.node)},i.prototype.save=function(){},i.prototype.cancel=function(){},t.exports=i},{"../../helpers/utils":20,"../overlay":11}],3:[function(e,t,n){var i=e("../../mvc/view"),o=e("../../helpers/utils"),s=e("../../mvc/extend"),r=e("../fields"),a=i.extend({initialize:function(){this.nodes={},this.setNodes(this.node),this.data.model.on("change",this.render.bind(this))},render:function(){var e=this.data.model.all()
o.each(this.nodes,function(t,n){e[n]&&(t.node.innerHTML=e[n])})},setNodes:function(e){var t=o.toArray(e.querySelectorAll("[data-name]")),n=this
t.forEach(function(e){var t=(e.dataset.name,e.dataset.type||"input")
e.dataset.type=t,n.nodes[e.dataset.name]=new r[e.dataset.type](e)})},collectData:function(){var e={}
return o.each(this.nodes,function(t){e[t.name]=t.value()}),e},activate:function(){o.each(this.nodes,function(e){e.activate()})},deactivate:function(){o.each(this.nodes,function(e){e.deactivate()})}})
a.extend=s(a),t.exports=a},{"../../helpers/utils":20,"../../mvc/extend":24,"../../mvc/view":28,"../fields":7}],4:[function(e,t,n){var i=e("../mvc"),o='<div class="edit">    <a class="edit-button button">        <i class="fa fa-fw fa-pencil"></i>    </a>    <a class="remove-button button">        <i class="fa fa-fw fa-trash"></i>    </a></div><div class="editing">    <a class="save-button button">        <i class="fa fa-fw fa-floppy-o"></i>    </a></div>',s=i.view.extend({initialize:function(){this.node=document.createElement("div"),this.node.className="m-editor m-dynamic",this.node.innerHTML=o,this.setupEvents(),this.show(!0)},setupEvents:function(){this.data.node.addEventListener("dblclick",this.edit.bind(this)),this.bind(".edit-button","click",this.edit),this.bind(".save-button","click",this.save),this.bind(".remove-button","click",this.remove)},disable:function(){this.data.component.disable(),s.editing=!1,this.show(!0)},edit:function(){s.editing||(s.editing=!0,this.data.component.enable(),this.show(!1))},remove:function(){window.confirm("Are you sure you want to delete this entry?")&&(this.disable(),this.data.component.remove(),this.destroy())},save:function(){this.disable(),this.data.component.save()},destroy:function(){this.node.parentNode.removeChild(this.node)},show:function(e){this.find(".edit").style.display=e?"block":"none",this.find(".editing").style.display=e?"none":"block",this.data.component.notRemovable&&(this.find(".remove-button").style.display="none")},inline:function(){this.node.classList.remove("m-dynamic"),this.find(".edit-button").innerHTML="Редактировать",this.find(".save-button").innerHTML="Сохранить",this.find(".remove-button").innerHTML="Удалить"}})
s.editing=!1,t.exports=s},{"../mvc":25}],5:[function(e,t,n){var i=e("../../helpers/dom"),o=e("./field"),s=function(){o.apply(this,arguments)}
s.prototype=Object.create(o.prototype),s.prototype.create=function(e){var t=document.createElement("input")
return t.classList.add("m-input-field"),t.classList.add("m-hidden"),t.value=e.innerHTML.trim(),t.className+=" "+e.className,i.insertAfter(e,t),t},s.prototype.activate=function(){this.field.classList.add("m-editable"),this.field.classList.remove("m-hidden"),this.node.classList.add("m-hidden")},s.prototype.deactivate=function(){this.field.classList.remove("m-editable"),this.field.classList.add("m-hidden"),this.node.classList.remove("m-hidden")},t.exports=s},{"../../helpers/dom":17,"./field":6}],6:[function(e,t,n){var i=function(e,t){this.field=this.create(e,t),this.name=e.dataset.name,this.node=e}
i.prototype.create=function(e,t){return e},i.prototype.activate=function(){},i.prototype.deactivate=function(){},i.prototype.value=function(){return this.field.value},t.exports=i},{}],7:[function(e,t,n){t.exports={input:e("./input"),text:e("./text")}},{"./input":8,"./text":9}],8:[function(e,t,n){arguments[4][5][0].apply(n,arguments)},{"../../helpers/dom":17,"./field":6,dup:5}],9:[function(e,t,n){var i=e("../../helpers/dom"),o=e("./Input"),s=function(){o.apply(this,arguments)}
s.prototype=Object.create(o.prototype),s.prototype.create=function(e){var t=document.createElement("textarea")
return t.classList.add("m-text-field"),t.classList.add("m-hidden"),t.value=e.innerHTML.trim(),t.className+=" "+e.className,i.insertAfter(e,t),t},s.prototype.activate=function(){o.prototype.activate.call(this),this.field.style.height=this.field.scrollHeight+6+"px"},t.exports=s},{"../../helpers/dom":17,"./Input":5}],10:[function(e,t,n){var i=e("./components/collection"),o=e("./settings"),s=e("../helpers/utils")
t.exports=function(e){o.assign(e),s.toArray(document.querySelectorAll("[data-component]")).forEach(i.createComponent)}},{"../helpers/utils":20,"./components/collection":1,"./settings":14}],11:[function(e,t,n){t.exports={element:null,show:function(){this.element||(this.element=document.createElement("div"),this.element.className="m-hidden m-overlay",document.body.appendChild(this.element)),this.element.classList.remove("m-hidden")},hide:function(){this.element&&this.element.classList.add("m-hidden")}}},{}],12:[function(e,t,n){var i=e("../components/collection"),o=e("../editor"),s=e("../../helpers/ajax"),r=e("../../mvc/view"),a=r.extend({initialize:function(){this.bind(".button","click",this.addView.bind(this))},addView:function(e){e.preventDefault(),o.editing||this.createNode(document.querySelector(".posts"))},createNode:function(e){var t=this,n=function(n,i){t.appendNode(i,e)}
s.post("api/template/posts").success(n).send()},appendNode:function(e,t){var n=document.createElement("div")
n.innerHTML=e.html
var o=n.children[0]
o.removeAttribute("data-id"),t.insertBefore(o,t.children[0]),i.createComponent(o),o.component.post.merge(e.data),o.editor.edit()}})
t.exports=new a(document.querySelector("#mini_panel .add"))},{"../../helpers/ajax":15,"../../mvc/view":28,"../components/collection":1,"../editor":4}],13:[function(e,t,n){e("../../helpers/utils")
t.exports={add:e("./add")}},{"../../helpers/utils":20,"./add":12}],14:[function(e,t,n){var i={settings:{},get:function(e){return this.settings[e]?this.settings[e]:null},set:function(e,t){this.settings[e]=t},assign:function(e){this.settings=e}}
t.exports=i},{}],15:[function(e,t,n){var i=e("../../core/settings"),o=e("./request"),s={}
s.request=function(e,t,n){var i=new o(this.url(e),t,n)
return i.on("data",function(e,t){"ok"===t.status?i.emit("success",e,t):i.emit("error",e,t.message)}),i.on("error",function(e,t){console.error(t)}),i},["get","post","put","delete"].forEach(function(e){var t=e.toUpperCase()
s[e]=function(e,n){return this.request(e,t,n)}}),s.url=function(e){return e=Array.isArray(e)?["",i.get("baseurl")].concat(e):["",i.get("baseurl"),e],e.join("/").replace(/\/+/,"/")},t.exports=s},{"../../core/settings":14,"./request":16}],16:[function(e,t,n){var i=e("../utils"),o=e("../events"),s=function(e,t,n){this.method=t||"GET",this.data=n||{},this.url=e,this.headers={"Content-type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"}}
o(s.prototype),s.prototype.send=function(){var e=new XMLHttpRequest,t=this.method.toUpperCase(),n=this.query(this.data),o=this.url,s=this
"GET"===t&&n&&(o+=(-1===o.indexOf("?")?"?":"&")+n),e.open(t,o),e.onreadystatechange=function(){var t,n=this.readyState,i=this.status
if(4===n&&200===i){try{t=JSON.parse(this.responseText)}catch(o){s.emit("error",e,"Invalid JSON")}t&&s.emit("data",this,t)}},e.onerror=function(){s.emit("error",e,"Connection error")},i.each(this.headers,function(t,n){e.setRequestHeader(n,t)}),e.send(n)},s.prototype.success=function(e){return this.on("success",e),this},s.prototype.error=function(e){return this.on("error",e),this},s.prototype.header=function(e,t){return this.headers[e]=t,this},s.prototype.query=function(e){var t="",n=Object.keys(e)
return n.forEach(function(n,i){t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&"}),t.substr(0,t.length-1)},t.exports=s},{"../events":18,"../utils":20}],17:[function(e,t,n){var i={}
i.attributes=function(e){for(var t={},n=e.attributes,i=0,o=n.length;o>i;i++){var s=n[i]
t[s.nodeName]=s.nodeValue}return t},i.dataAttributes=function(e){var t=mini_blog.dom.attributes(e)
return Object.keys(t).forEach(function(e){0!==e.indexOf("data-")&&delete t[e]}),t},i.hasParent=function(e,t){return t(e.parentNode)?!0:e.parentNode===document.documentElement?!1:i.hasParent(e.parentNode,t)},i.insertAfter=function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},t.exports=i},{}],18:[function(e,t,n){var i=function(e){e.on=function(e,t){this._events||(this._events={}),this._events[e]||(this._events[e]=[]),this._events[e].push(t)},e.emit=function(e){if(this._events&&this._events[e]){var t=mini_blog.toArray(arguments).slice(1)
this._events[e].forEach(function(e){e&&e.apply(e,t)})}}}
t.exports=i},{}],19:[function(e,t,n){var i=function(e){return e=e||(e=0),function(){return++e}}
t.exports=i},{}],20:[function(e,t,n){var i=function(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},o=function(e,t){var n={}
for(var i in t)("undefined"==typeof e[i]||t[i]!==e[i])&&(n[i]=t[i]||e[i])
return n},s=function(e,t){var n,i={}
for(n in e)i[n]=e[n]
for(n in t)i[n]=t[n]
return i},r=function(e,t){for(var n in t)e[n]=t[n]},a=function(e){return Array.prototype.slice.call(e)},c=function(e,t){var n={}
return t.forEach(function(t){e[t]&&(n[t]=e[t])}),n}
t.exports={toArray:a,extend:r,merge:s,diff:o,each:i,pick:c}},{}],21:[function(e,t,n){var i=e("./helpers/utils"),o={components:e("./core/components/collection"),component:e("./core/components/component"),settings:e("./core/settings"),editor:e("./core/editor"),fields:e("./core/fields"),field:e("./core/fields/field"),panel:e("./core/panel"),init:e("./core/init"),events:e("./helpers/events"),unique:e("./helpers/unique"),ajax:e("./helpers/ajax"),dom:e("./helpers/dom"),mvc:e("./mvc")}
i.extend(o,i),o.component.view=e("./core/components/view"),t.exports=o},{"./core/components/collection":1,"./core/components/component":2,"./core/components/view":3,"./core/editor":4,"./core/fields":7,"./core/fields/field":6,"./core/init":10,"./core/panel":13,"./core/settings":14,"./helpers/ajax":15,"./helpers/dom":17,"./helpers/events":18,"./helpers/unique":19,"./helpers/utils":20,"./mvc":25}],22:[function(e,t,n){var i=e("../../helpers/ajax")
t.exports={fetch:function(e,t,n){var o=e.options,s=isNaN(t)?t.id:t
i.get([o.baseurl,o.get,s]).success(function(i,o){var s=isNaN(t),r=e.create(e.parse(o),t)
s||(n&&n(t),e.emit("get",r))}).send()},insert:function(e,t,n){var o=e.options
i.post([o.baseurl,o.insert],t.all()).success(function(i,o){t.id=o.id,n&&n(t),e.emit("add",t)}).send()},update:function(e,t,n){var o=e.options
i.post([o.baseurl,o.update,t.id],t.diff()).success(function(){n&&n(t),e.emit("update",t)}).send()},remove:function(e,t,n){var o=e.options
i.post([o.baseurl,o.remove,t.id]).success(function(){t.destroy(),n&&n(t),e.emit("remove",t)}).send()}}},{"../../helpers/ajax":15}],23:[function(e,t,n){var i=e("../helpers/utils"),o=e("../helpers/events"),s=e("./extend"),r=e("./model"),a=function(e){this.models=e||{}}
o(a.prototype),a.prototype.get=function(e){return this.models[e]},a.prototype.add=function(e){this.models[e.id]=e,this.emit("add",e)},a.prototype.remove=function(e){var t=this.models[e]
delete this.models[e],this.emit("remove",t)},a.prototype.bootstrap=function(e){var t=this,n=function(e,n){e.id=e.id||n
var i=new r(e)
t.models[i.id]=i}
Array.isArray(e)?e.forEach(n):i.each(e,n)},a.prototype.forEach=function(e){i.each(this.models,e)},a.prototype.bindTo=function(e){var t=this.add.bind(this)
e.on("get",t),e.on("add",t),e.on("remove",this.remove.bind(this))},a.extend=s(a),t.exports=a},{"../helpers/events":18,"../helpers/utils":20,"./extend":24,"./model":27}],24:[function(e,t,n){var i=e("../helpers/utils"),o=function(e){return function(t){var n=function(){e.apply(this,i.toArray(arguments))}
return n.prototype=Object.create(e.prototype),i.each(t,function(e,t){n.prototype[t]=e}),n}}
t.exports=o},{"../helpers/utils":20}],25:[function(e,t,n){t.exports={collection:e("./collection"),mapper:e("./mapper"),model:e("./model"),view:e("./view")}},{"./collection":23,"./mapper":26,"./model":27,"./view":28}],26:[function(e,t,n){var i=e("../helpers/events"),o=e("./extend"),s=e("./model"),r=e("../helpers/utils"),a=e("./adapters/ajax"),c={baseurl:"/",adapter:a,model:s,get:"get",insert:"add",update:"edit",remove:"remove"},d=function(e){this.options=r.merge(c,e),this.adapter=this.options.adapter}
i(d.prototype),d.prototype.parse=function(e){return e},d.prototype.create=function(e,t){return t&&t instanceof s?(t.merge(e),t):new this.options.model(e)},d.prototype.fetch=function(e,t){this.adapter.fetch(this,e,t)},d.prototype.insert=function(e,t){this.adapter.insert(this,e,t)},d.prototype.update=function(e,t){this.adapter.update(this,e,t)},d.prototype.save=function(e,t){e.isNew()?this.insert(e,t):this.update(e,t)},d.prototype.remove=function(e,t){this.adapter.remove(this,e,t)},d.prototype.sync=function(e){e.forEach(function(t){t.isNew()?self.insert(t):t.isEmpty()?(self.remove(t),e.remove(t.id)):t.isDirty()&&self.update(t)})},d.extend=o(d),t.exports=d},{"../helpers/events":18,"../helpers/utils":20,"./adapters/ajax":22,"./extend":24,"./model":27}],27:[function(e,t,n){var i=e("../helpers/events"),o=e("../helpers/utils"),s=e("../helpers/unique")(),r=e("./extend"),a=function(e){var t=e&&e.id?e.id:-s()
e&&e.id&&delete e.id,e=o.merge(this.data||{},e||{}),this.previous=o.merge({},e),this.data=e,this.id=t}
i(a.prototype),a.prototype.get=function(e){return this.data[e]?this.data[e]:!1},a.prototype.set=function(e,t){this.data[e]=t,this.emit("change")},a.prototype.clear=function(){this.previous=o.merge({},this.data)},a.prototype.revert=function(){this.data=o.merge({},this.previous),this.emit("change")},a.prototype.all=function(){return o.merge(this.data,{})},a.prototype.diff=function(){return o.diff(this.previous,this.data)},a.prototype.destroy=function(){this.data={},this.id=-s(),this.emit("destroy")},a.prototype.reset=function(e){this.data=e,this.emit("change")},a.prototype.merge=function(e){e.id&&(this.id=e.id,delete e.id),this.data=o.merge(this.data,e),this.emit("change")},a.prototype.isNew=function(){return this.id<0},a.prototype.isDirty=function(){return Object.keys(this.diff()).length>0},a.prototype.isEmpty=function(){return 0===Object.keys(this.data).length},a.extend=r(a),t.exports=a},{"../helpers/events":18,"../helpers/unique":19,"../helpers/utils":20,"./extend":24}],28:[function(e,t,n){var i=e("./extend"),o=function(e,t){this.node=e,this.data=t,this.initialize()}
o.prototype.initialize=function(){},o.prototype.find=function(e){var t=this.node.querySelector(e)
return t||console.warn('Could not find node by selector "'+e+'"'),t},o.prototype.bind=function(e,t,n){var i=e instanceof Node?e:this.find(e)
i?i.addEventListener(t,n.bind(this)):console.warn("Node is not suitable for attaching events!")},o.extend=i(o),t.exports=o},{"./extend":24}]},{},[21])(21)})
